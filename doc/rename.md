# 文件重命名模块 (rename.js)

## 1. 模块概述

文件重命名模块用于批量重命名当前目录下的文件，按照指定前缀和递增序号的格式进行重命名，适用于整理下载的图片或其他文件。

## 2. 功能说明

| 功能 | 描述 |
|------|------|
| 批量重命名 | 批量重命名当前目录下的所有文件 |
| 自定义前缀 | 可以自定义文件名前缀，默认P |
| 递增序号 | 按照P00001、P00002的格式生成序号 |
| 保留扩展名 | 保留原文件的扩展名 |
| 输出日志 | 显示重命名过程和结果 |

## 3. 命令格式

```bash
daji rename [options]
# 或
daji rn [options]
```

## 4. 选项说明

| 选项 | 缩写 | 参数 | 描述 |
|------|------|------|------|
| --prefix | -p | 字符串 | 自定义前缀，默认P |
| --dir | -d | 无 | 递归处理子目录 |
| --number | -num | 数字 | 序号位数，默认5位 |
| --type | -type | <types...> | 文件类型，支持多个类型，如: jpg png gif，不区分大小写，jpg和jpeg视为同一类型 |
| --forceDir | 无 | 无 | 强制重命名文件夹，从1开始自增，先处理子目录再处理父目录 |

## 5. 使用示例

### 5.1 使用默认前缀重命名

```bash
daji rename
# 或
daji rn
```

执行此命令后，工具会将当前目录下的文件按照P00001、P00002的格式重命名。

### 5.2 使用自定义前缀重命名

```bash
daji rename -p IMG
# 或
daji rn -p IMG
```

执行此命令后，工具会将当前目录下的文件按照IMG00001、IMG00002的格式重命名。

### 5.3 按文件类型重命名

```bash
daji rn -p p -type jpg
```

执行此命令后，工具会将当前目录下的所有jpg文件按照p00001.jpg、p00002.jpg的格式重命名。

### 5.4 多类型文件重命名

```bash
daji rn -p p -type jpg png gif
```

执行此命令后，工具会将当前目录下的所有jpg、png、gif文件按照p00001.jpg、p00002.png、p00003.gif的格式重命名。

### 5.5 自定义序号位数

```bash
daji rn -p p -num 4
```

执行此命令后，工具会将当前目录下的文件按照p0001、p0002的4位数格式重命名。

### 5.6 递归处理子目录

```bash
daji rn -p p -d -type jpg
```

执行此命令后，工具会递归处理当前目录及其子目录下的所有jpg文件，每个目录内的文件从p00001.jpg开始编号。

### 5.7 结合多个选项

```bash
daji rn -p p -d -type jpg png -num 4
```

执行此命令后，工具会递归处理当前目录及其子目录下的所有jpg、png文件，每个目录内的文件从p0001.jpg开始编号（4位数）。

### 5.8 重命名文件夹

```bash
daji rn -forceDir
```

执行此命令后，工具会将当前目录下的文件夹按照1、2、3的格式重命名，先处理子目录再处理父目录。

### 5.9 结合文件和文件夹重命名

```bash
daji rn -p p -type jpg -forceDir
```

执行此命令后，工具会同时重命名当前目录下的jpg文件和文件夹，文件按p00001.jpg格式，文件夹按1、2、3格式。

## 6. 实现原理

1. **获取文件和文件夹列表**：
   - 读取当前目录下的所有文件和文件夹
   - 如果指定了 `-d` 选项，则递归处理子目录
   - 分别收集文件和文件夹列表

2. **文件类型过滤**：
   - 如果指定了 `-type` 选项，按类型过滤文件
   - 统一转换为小写，jpg和jpeg视为同一类型
   - 不区分文件类型的大小写

3. **构建新文件名**：
   - 使用指定前缀（默认P）
   - 生成指定位数的递增序号（默认5位，不足补零）
   - 保留原文件的扩展名

4. **执行文件重命名**：
   - 按目录分组文件
   - 每个目录内的文件独立编号
   - 按文件名排序后逐个执行重命名
   - 输出重命名过程

5. **执行文件夹重命名**：
   - 如果指定了 `-forceDir` 选项，重命名文件夹
   - 按路径长度排序，确保先处理子目录
   - 文件夹名称从1开始自增
   - 输出重命名过程

6. **统计结果**：
   - 统计成功和失败的文件数量
   - 统计成功和失败的文件夹数量
   - 输出最终结果

## 7. 输出示例

```
当前目录: /Users/user/Downloads/images
找到 5 个文件，准备重命名...
==============================
DSC_0001.jpg → P00001.jpg
DSC_0002.jpg → P00002.jpg
DSC_0003.jpg → P00003.jpg
DSC_0004.jpg → P00004.jpg
DSC_0005.jpg → P00005.jpg
==============================
重命名完成！成功: 5 个，失败: 0 个
```

## 8. 注意事项

- 该命令会重命名当前目录下的**所有文件**，请谨慎使用
- 建议在执行前先备份重要文件
- 文件名会按字母顺序排序后再重命名
- 命令执行后无法撤销，请确保操作正确

## 9. 依赖关系

- 无外部依赖，仅使用Node.js内置的`fs`和`path`模块
